(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{1088:function(e,a,t){"use strict";var n=t(54),r=t(64),l=t.n(r),c="[CONSULTATIONS FOURNISSEUR APP] REQUEST CONSULTATIONS",i="[CONSULTATIONS FOURNISSEUR APP] SET PARAMETRES DATA",s="[USERS APP] GET CONSULTATIONS",d="[USERS APP] SET CONSULTATIONS SEARCH TEXT";function o(e,a){var t="";e.search.length>0&&e.search.map(function(e,a){e.value&&("created"===e.id||"dateExpiration"===e.id?t+="&"+e.id+"[after]="+e.value:"demande.statut"===e.id?"1"===e.value?t+="&demande.statut=1&demande.dateExpiration[strictly_after]=".concat(l()().format("YYYY-MM-DDTHH:mm:ss")):"3"===e.value&&(t+="&demande.dateExpiration[strictly_before]=".concat(l()().format("YYYY-MM-DDTHH:mm:ss"))):t+="&"+e.id+"="+e.value)});var r=n.a.get("/api/detail_visites?page=".concat(e.page).concat(t,"&fournisseur=").concat(a,"&order[").concat(e.filter.id,"]=").concat(e.filter.direction));return function(e){return e({type:c}),r.then(function(a){return e({type:s,payload:a.data})})}}function m(e){return{type:i,parametres:e}}var u=t(40),p=t(36),f="[CONSULTATION FOURNISSEUR APP] REQUEST CONSULTATION",E="[CONSULTATION FOURNISSEUR APP] GET CONSULTATION",h="[CONSULTATION FOURNISSEUR APP] GET_PERSONNELS",b="[CONSULTATION FOURNISSEUR APP] REQUEST SAVE",N="[CONSULTATION FOURNISSEUR APP] SAVE CONSULTANTION",g="[CONSULTATION FOURNISSEUR APP] SAVE ERROR",x="[CONSULTATION FOURNISSEUR APP] CLEAN_UP";function y(){return function(e){return e({type:x})}}function v(e){var a=n.a.get("/api/detail_visites/".concat(e));return function(e){return e({type:f}),a.then(function(a){e({type:E,payload:a.data})})}}function O(e){var a=n.a.get("/api/fournisseurs/".concat(e,"/personnels"));return function(e){return a.then(function(a){e({type:h,payload:a.data["hydra:member"]})})}}function S(e){var a={budget:parseFloat(e.budget),personnel:e.personnel?e.personnel.value:null,sendEmail:!!e.sendEmail&&e.sendEmail},t=n.a.put(e["@id"],a);return function(e){return e({type:b}),t.then(function(a){return e(Object(p.B)({message:"Consultation Modifi\xe9e"})),e({type:N,payload:a.data})}).catch(function(a){e({type:g,payload:u.y.parseApiErrors(a)})})}}t.d(a,"f",function(){return c}),t.d(a,"k",function(){return i}),t.d(a,"c",function(){return s}),t.d(a,"j",function(){return d}),t.d(a,"n",function(){return o}),t.d(a,"q",function(){return m}),t.d(a,"e",function(){return f}),t.d(a,"b",function(){return E}),t.d(a,"d",function(){return h}),t.d(a,"g",function(){return b}),t.d(a,"h",function(){return N}),t.d(a,"i",function(){return g}),t.d(a,"a",function(){return x}),t.d(a,"l",function(){return y}),t.d(a,"m",function(){return v}),t.d(a,"o",function(){return O}),t.d(a,"p",function(){return S})},1161:function(e,a,t){"use strict";var n=t(46),r=t(8),l=t(1088),c=t(107),i={data:[],pageCount:null,loading:!1,searchText:"",parametres:{page:1,description:"",search:[],filter:{id:"created",direction:"desc"}}},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case l.f:return Object(r.a)({},e,{loading:!0});case l.c:return Object(r.a)({},e,{data:a.payload["hydra:member"],pageCount:c.a.hydraPageCount(a.payload),loading:!1});case l.j:return Object(r.a)({},e,{searchText:a.searchText});case l.k:return Object(r.a)({},e,{parametres:{page:a.parametres.page,search:a.parametres.search,description:a.parametres.description,filter:{id:a.parametres.filter.id,direction:a.parametres.filter.direction}}});default:return e}},d={data:null,error:null,loading:!1,personnels:null,request:!1},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case l.e:return Object(r.a)({},e,{loading:!0});case l.g:return Object(r.a)({},e,{request:!0});case l.a:return Object(r.a)({},e,{data:null,loading:!1,error:null});case l.b:return Object(r.a)({},e,{data:a.payload,loading:!1});case l.d:return Object(r.a)({},e,{personnels:a.payload});case l.h:return Object(r.a)({},e,{request:!1});case l.i:return Object(r.a)({},e,{error:a.payload,loading:!1});default:return e}},m=Object(n.d)({consultations:s,consultation:o});a.a=m},1336:function(e,a,t){"use strict";t.r(a);var n=t(8),r=t(23),l=t(0),c=t.n(l),i=t(98),s=t(1013),d=t(1032),o=t(1044),m=t(1027),u=t(1040),p=t(1039),f=t(1023),E=t(1046),h=t(1035),b=t(1041),N=t(1020),g=t(163),x=t(345),y=t(40),v=t(18),O=t(2),S=t(10),I=t(6),P=t(140),T=t(1088),A=t(1161),j=t(55),F=t.n(j),w=t(64),U=t.n(w),R=t(974),C=t(141),W=Object(x.a)(function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}},consultationImageFeaturedStar:{position:"absolute",top:0,right:0,color:g.a[400],opacity:0},consultationImageUpload:{transitionProperty:"box-shadow",transitionDuration:e.transitions.duration.short,transitionTimingFunction:e.transitions.easing.easeInOut},consultationImageItem:{transitionProperty:"box-shadow",transitionDuration:e.transitions.duration.short,transitionTimingFunction:e.transitions.easing.easeInOut,"&:hover":{"& $consultationImageFeaturedStar":{opacity:.8}},"&.featured":{pointerEvents:"none",boxShadow:e.shadows[3],"& $consultationImageFeaturedStar":{opacity:1},"&:hover $consultationImageFeaturedStar":{opacity:1}}},error:{backgroundColor:e.palette.error.dark},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:e.spacing(1)},message:{display:"flex",alignItems:"center"},margin:{margin:e.spacing(1)},chip:{marginLeft:e.spacing(1),background:"#ef5350",color:"white",fontWeight:"bold",fontSize:"11px"},chip2:{marginLeft:e.spacing(1),background:"#4caf50",color:"white",fontWeight:"bold",fontSize:"11px"},chip3:{margin:e.spacing(1),background:"green",color:"white",fontWeight:"bold",fontSize:"11px"}}});a.default=Object(P.a)("consultationsFrsApp",A.a)(function(e){var a=Object(l.useState)(!1),t=Object(r.a)(a,2),g=t[0],x=t[1],P=Object(l.useState)(!1),A=Object(r.a)(P,2),j=A[0],w=A[1],L=Object(l.useRef)(null),k=Object(C.b)(null),Y=k.form,D=k.handleChange,_=k.setForm,q=Object(I.b)(),M=Object(I.c)(function(e){return e.consultationsFrsApp.consultation}),H=Object(I.c)(function(e){return e.auth.user}),V=W(e),z=Object(l.useState)(0),G=Object(r.a)(z,2),B=G[0],Q=G[1],$=Object(l.useState)(1),J=Object(r.a)($,2),X=J[0],K=J[1];return Object(l.useEffect)(function(){q(T.o(H.id))},[q,H.id]),Object(l.useEffect)(function(){var a=e.match.params.consultationId;return q(T.m(a)),function(){q(T.l())}},[q,e.match.params]),Object(l.useEffect)(function(){(M.data&&!Y||M.data&&Y&&M.data.id!==Y.id)&&(_(Object(n.a)({},M.data)),M.data.personnel&&x({value:M.data.personnel["@id"],label:M.data.personnel.name}))},[Y,M.data,_]),c.a.createElement(y.o,{classes:{toolbar:"p-0",header:"min-h-72 h-72 sm:h-136 sm:min-h-136"},header:M.loading?"":M.data&&c.a.createElement("div",{className:"flex flex-1 w-full items-center justify-between"},c.a.createElement("div",{className:"flex flex-col items-start max-w-full"},c.a.createElement(y.d,{animation:"transition.slideRightIn",delay:300},c.a.createElement(i.a,{className:"normal-case flex items-center sm:mb-12",component:v.a,role:"button",to:"/consultations",color:"inherit"},c.a.createElement(s.a,{className:"mr-4 text-20"},"arrow_back"),"Retour")),c.a.createElement("div",{className:"flex items-center max-w-full"},c.a.createElement("div",{className:"flex flex-col min-w-0"},c.a.createElement(y.d,{animation:"transition.slideLeftIn",delay:300},c.a.createElement("div",{className:"text-16 sm:text-20 truncate"},M.data.demande.reference?"RFQ-"+M.data.demande.reference:"",U()(M.data.demande.dateExpiration)>=U()()?0===M.data.demande.statut?c.a.createElement(R.a,{className:V.chipOrange,label:"En attente"}):1===M.data.demande.statut?c.a.createElement(R.a,{className:V.chip2,label:"En cours"}):c.a.createElement(R.a,{className:V.chip,label:"Refus\xe9e"}):c.a.createElement(R.a,{className:V.chip,label:"Expir\xe9e"}),U()(M.data.demande.dateExpiration)>=U()()?c.a.createElement(R.a,{className:V.chip2,label:0===U()(M.data.demande.dateExpiration).diff(U()(),"days")?U()(M.data.demande.dateExpiration).diff(U()(),"hours")+" h":U()(M.data.demande.dateExpiration).diff(U()(),"days")+" j"}):c.a.createElement(R.a,{className:V.chip,label:0===U()(M.data.demande.dateExpiration).diff(U()(),"days")?U()(M.data.demande.dateExpiration).diff(U()(),"hours")+" h":U()(M.data.demande.dateExpiration).diff(U()(),"days")+" j"}))))))),contentToolbar:M.loading?c.a.createElement("div",{className:V.root},c.a.createElement(d.a,{color:"secondary"})):c.a.createElement(o.a,{value:B,onChange:function(e,a){Q(a)},indicatorColor:"secondary",textColor:"secondary",variant:"scrollable",scrollButtons:"auto",classes:{root:"w-full h-64"}},c.a.createElement(m.a,{className:"h-64 normal-case",label:"Infos g\xe9n\xe9rales"}),c.a.createElement(m.a,{className:"h-64 normal-case",label:M.data&&M.data.demande.attachements.length>0?"Pi\xe8ce(s) jointe(s) ("+M.data.demande.attachements.length+")":"Pi\xe8ce(s) jointe(s)"}),M.data?c.a.createElement(m.a,{className:"h-64 normal-case text-orange font-bold",label:"Profil Acheteur"}):""),content:M.loading?"":Y&&c.a.createElement("div",{className:"p-10  sm:p-24 max-w-2xl"},0===B&&c.a.createElement(F.a,{onValidSubmit:function(e){q(T.p(Y))},onValid:function(){w(!0)},onInvalid:function(){w(!1)},ref:L,className:"flex flex-col "},c.a.createElement(u.a,{container:!0,spacing:3},c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.F,{className:"mb-24",label:"R\xe9f\xe9rence",id:"reference",name:"reference",value:M.data.demande.reference,InputProps:{readOnly:!0,startAdornment:c.a.createElement(p.a,{position:"start"},"RFQ-")},fullWidth:!0})),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.F,{className:"mb-24",label:"Date d'expiration",id:"dateExpiration",name:"dateExpiration",value:U()(M.data.demande.dateExpiration).format("DD/MM/YYYY HH:mm"),InputProps:{readOnly:!0},fullWidth:!0})),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.F,{className:"mb-24",label:"Date de cr\xe9ation",id:"dateCreated",name:"dateCreated",value:U()(M.data.demande.created).format("DD/MM/YYYY HH:mm"),InputProps:{readOnly:!0},fullWidth:!0}))),c.a.createElement(u.a,{container:!0,spacing:3},c.a.createElement(u.a,{item:!0,xs:12,sm:12},c.a.createElement(y.F,{className:"mb-24",label:"Activit\xe9s",id:"sousSecteurs",name:"sousSecteurs",value:S.a.join(S.a.map(M.data.demande.categories,"name"),", "),InputProps:{readOnly:!0},fullWidth:!0}))),c.a.createElement(u.a,{container:!0,spacing:3},H.data&&H.data.currency===M.data.demande.currency.name?c.a.createElement(u.a,{item:!0,xs:12,sm:12},c.a.createElement(y.F,{className:"mb-24",label:"Budget en "+M.data.demande.currency.name,id:"budget",type:"number",name:"budget",onChange:D,value:Y.budget,validations:{isNumeric:!0},validationErrors:{isNumeric:"Numeric value required"},step:"any",InputProps:{min:1},required:!0,fullWidth:!0})):c.a.createElement(c.a.Fragment,null,c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.F,{className:"mb-24",type:"text",name:"description",value:M.data.demande.budget,label:"Budget en "+M.data.demande.currency.name,InputProps:{readOnly:!0},fullWidth:!0})),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.F,{className:"mb-24",label:"Taux de change : "+M.data.demande.currency.name+" => "+H.data.currency,id:"taux",type:"number",name:"taux",value:S.a.toString(X),validations:{isNumeric:!0},validationErrors:{isNumeric:"Numeric value required"},step:"any",InputProps:{min:1,step:"any"},onChange:function(e){return function(e){var a=M.data.demande.budget*e.target.value;_(S.a.set(Object(n.a)({},Y),"budget",a)),K(e.target.value)}(e)},fullWidth:!0})),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.F,{className:"mb-24",label:"Budget en ("+H.data.currency+")",id:"budget",type:"number",name:"budget",onChange:D,value:S.a.toString(Y.budget),validations:{isNumeric:!0},validationErrors:{isNumeric:"Numeric value required"},InputProps:{min:1,step:"any"},required:!0,fullWidth:!0})))),c.a.createElement(y.F,{className:"mb-16  w-full",type:"text",name:"description",value:M.data.demande.description,label:"Description",multiline:!0,rows:"4",InputProps:{readOnly:!0}}),c.a.createElement(u.a,{container:!0,spacing:3},c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.E,{id:"personnel",name:"personnel",value:g,placeholder:"S\xe9lectionner...",textFieldProps:{label:"Affecter \xe0",InputLabelProps:{shrink:!0},variant:"outlined"},className:"mt-20",options:M.personnels,onChange:function(e){return function(e,a){_(S.a.set(Object(n.a)({},Y),a,e)),x(e)}(e,"personnel")},required:!0})),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.a,{className:"mt-20",name:"sendEmail",disabled:0!==Y.statut||!Y.personnel,onChange:function(e){return function(e,a){_(S.a.set(Object(n.a)({},Y),a,e.target.checked))}(e,"sendEmail")},label:"Alerter par email"})),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.C,{className:"mt-20 inline",name:"statut",label:"Statut"},c.a.createElement(f.a,{value:"0",disabled:!0,checked:0===Y.statut,control:c.a.createElement(E.a,null),label:"En cours"}),c.a.createElement(f.a,{value:"1",disabled:!0,checked:1===Y.statut,control:c.a.createElement(E.a,null),label:"Gagn\xe9e"}),c.a.createElement(f.a,{value:"2",disabled:!0,checked:2===Y.statut,control:c.a.createElement(E.a,null),label:"Perdue"})))),c.a.createElement(h.a,{type:"submit",variant:"contained",color:"primary",className:"w-200 pr-auto mt-16 normal-case","aria-label":"Suivant",disabled:!j||M.request,value:"legacy"},"Sauvegarder",M.request&&c.a.createElement(b.a,{size:24,className:V.buttonProgress}))),1===B&&c.a.createElement("div",null,c.a.createElement("div",{className:"flex justify-center sm:justify-start flex-wrap"},M.data.demande.attachements.length>0?M.data.demande.attachements.map(function(e){return c.a.createElement("div",{className:Object(O.a)(V.consultationImageItem,"flex items-center cursor-pointer justify-center relative w-128 h-128 rounded-4 mr-16 mb-16 overflow-hidden  shadow-1 hover:shadow-5"),key:e.id,onClick:function(){return window.open(y.G+e.url,"_blank")}},"image"===S.a.split(e.type,"/",1)[0]?c.a.createElement("img",{className:"max-w-none w-auto h-full",src:y.G+e.url,alt:"consultation"}):c.a.createElement(s.a,{color:"secondary",style:{fontSize:80}},"insert_drive_file"))}):"Aucune pi\xe8ce jointe attach\xe9e a cette consultation")),2===B&&(M.data?c.a.createElement(F.a,{className:"flex flex-col"},c.a.createElement(u.a,{container:!0,spacing:3,className:"mb-5"},c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement("div",{className:"flex"},c.a.createElement(y.F,{className:"",type:"text",name:"fullname",value:M.data.demande.acheteur.civilite+" "+M.data.demande.acheteur.firstName+" "+M.data.demande.acheteur.lastName,label:"Nom complet",InputProps:{readOnly:!0},fullWidth:!0}))),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement("div",{className:"flex"},c.a.createElement(y.F,{className:"",name:"email",value:M.data.demande.acheteur.email,label:"Email",fullWidth:!0,InputProps:{readOnly:!0,endAdornment:c.a.createElement(p.a,{position:"end"},c.a.createElement(s.a,{className:"text-20",color:"action"},"email"))}}))),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.F,{className:"",type:"text",name:"phonep",id:"phonep",value:M.data.demande.acheteur.phone,label:"T\xe9l\xe9phone",InputProps:{readOnly:!0,endAdornment:c.a.createElement(p.a,{position:"end"},c.a.createElement(s.a,{className:"text-20",color:"action"},"local_phone"))},fullWidth:!0}))),c.a.createElement(N.a,null),c.a.createElement(u.a,{container:!0,spacing:3,className:"mb-5"},c.a.createElement(u.a,{item:!0,xs:12,sm:8},c.a.createElement("div",{className:"flex"},c.a.createElement(y.F,{className:"mt-20",label:"Raison sociale",id:"societe",name:"societe",value:M.data.demande.acheteur.societe,fullWidth:!0,InputProps:{readOnly:!0}}))),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement("div",{className:"flex"},c.a.createElement(y.F,{className:"mt-20",name:"fix",value:M.data.demande.acheteur.fix,label:"Fixe",InputProps:{readOnly:!0,endAdornment:c.a.createElement(p.a,{position:"end"},c.a.createElement(s.a,{className:"text-20",color:"action"},"local_phone"))},fullWidth:!0}))),c.a.createElement(u.a,{item:!0,xs:12,sm:8},c.a.createElement(y.F,{id:"secteur",className:"",name:"secteur",label:"Secteur",value:M.data.demande.acheteur.secteur?M.data.demande.acheteur.secteur.name:"",fullWidth:!0,InputProps:{readOnly:!0}})),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement("div",{className:"flex"},c.a.createElement(y.F,{id:"website",className:"",type:"text",name:"website",value:M.data.demande.acheteur.website,label:"Site Web",InputProps:{readOnly:!0,endAdornment:c.a.createElement(p.a,{position:"end"},c.a.createElement(s.a,{className:"text-20",color:"action"},"language"))},fullWidth:!0}))),c.a.createElement(u.a,{item:!0,xs:12,sm:8},c.a.createElement("div",{className:"flex"},M.data.demande.acheteur.ice?c.a.createElement(y.F,{className:"",type:"text",name:"ice",id:"ice",value:M.data.demande.acheteur.ice,label:"ICE",fullWidth:!0,InputProps:{readOnly:!0}}):""))),c.a.createElement(N.a,null),c.a.createElement(u.a,{container:!0,spacing:3,className:"mb-5"},c.a.createElement(u.a,{item:!0,xs:12,sm:8},c.a.createElement("div",{className:"flex"},c.a.createElement(y.F,{className:"mt-20",type:"text",name:"adresse1",id:"adresse1",value:M.data.demande.acheteur.adresse1,label:"Adresse 1",InputProps:{readOnly:!0,endAdornment:c.a.createElement(p.a,{position:"end"},c.a.createElement(s.a,{className:"text-20",color:"action"},"location_on"))},fullWidth:!0}))),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.F,{className:"mt-20",type:"text",name:"pays",id:"pays",value:M.data.demande.acheteur.pays?M.data.demande.acheteur.pays.name:"",label:"Pays",InputProps:{readOnly:!0},fullWidth:!0})),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement("div",{className:"flex"},c.a.createElement(y.F,{className:"",type:"text",name:"adresse2",value:M.data.demande.acheteur.adresse2,label:"Adresse 2",InputProps:{readOnly:!0,endAdornment:c.a.createElement(p.a,{position:"end"},c.a.createElement(s.a,{className:"text-20",color:"action"},"location_on"))},fullWidth:!0}))),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement("div",{className:"flex"},c.a.createElement(y.F,{className:"",name:"codepostal",value:String(M.data.demande.acheteur.codepostal),label:"Code Postal",fullWidth:!0,InputProps:{readOnly:!0}}))),c.a.createElement(u.a,{item:!0,xs:12,sm:4},c.a.createElement(y.F,{className:"",type:"text",name:"ville",id:"ville",value:M.data.demande.acheteur.ville?M.data.demande.acheteur.ville.name:"",label:"Ville",InputProps:{readOnly:!0},fullWidth:!0}))),c.a.createElement(N.a,null),c.a.createElement(u.a,{container:!0,spacing:3},c.a.createElement(u.a,{item:!0,xs:12,sm:12},c.a.createElement(y.F,{className:"mb-5 mt-20  w-full",type:"text",name:"description",value:M.data.demande.acheteur.description,label:"Pr\xe9sentation",multiline:!0,rows:"8",InputProps:{readOnly:!0}})))):"")),innerScroll:!0})})}}]);