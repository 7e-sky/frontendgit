(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{1051:function(e,t,a){"use strict";var n=a(3),r=a.n(n),i=a(4),o=a.n(i),c=a(0),l=a.n(c),s=(a(1),a(2)),u=a(7),m=a(98),d=l.a.forwardRef(function(e,t){var a=e.children,n=e.classes,i=e.className,c=e.disableTypography,u=void 0!==c&&c,d=o()(e,["children","classes","className","disableTypography"]);return l.a.createElement("div",r()({className:Object(s.a)(n.root,i),ref:t},d),u?a:l.a.createElement(m.a,{variant:"h6"},a))});t.a=Object(u.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(d)},1052:function(e,t,a){"use strict";var n=a(3),r=a.n(n),i=a(0),o=a.n(i),c=(a(1),a(7)),l=a(98),s=o.a.forwardRef(function(e,t){return o.a.createElement(l.a,r()({component:"p",variant:"body1",color:"textSecondary",ref:t},e))});t.a=Object(c.a)({root:{marginBottom:16}},{name:"MuiDialogContentText"})(s)},1361:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(40),o=a(6),c=a(140),l=a(23),s=a(974),u=a(967),m=a(958),d=a(1051),p=a(1037),f=a(1052),b=a(1038),E=a(1035),g=a(1013),h=a(347),O=a(54),v=a(107),y=a(36),A=a(10),j=a(196),C="[COMMANDES APP] GET COMMANDES",N="[COMMANDES APP] SET SEARCH TEXT",M="[COMMANDES APP] OPEN NEW COMMANDES DIALOG",P="[COMMANDES APP] CLOSE NEW COMMANDES DIALOG",x="[COMMANDES APP] OPEN EDIT COMMANDES DIALOG",D="[COMMANDES APP] CLOSE EDIT COMMANDES DIALOG",S="[COMMANDES APP] ADD COMMANDE",w="[COMMANDES APP] SAVE ERROR",T="[COMMANDES APP] REQUEST_COMMANDES",I="[COMMANDES APP] REMOVE COMMANDE",L="[COMMANDES APP] SET PARAMETRES DATA",k="[COMMANDES APP] CLEAN_UP",F="[COMMANDES APP] GET_PAIEMENT";function z(e){return{type:L,parametres:e}}function J(e){var t="";e.search.length>0&&e.search.map(function(e){return e.value&&("created"===e.id?t+="&"+e.id+"[after]="+e.value:t+="&"+e.id+"="+e.value)});var a=O.a.get("/api/demande_jetons?page=".concat(e.page).concat(t,"&order[").concat(e.filter.id,"]=").concat(e.filter.direction));return function(e){return e({type:T}),a.then(function(t){e({type:C,payload:t.data})})}}var R="[DIALOG] OPEN",W="[DIALOG] CLOSE";function H(){return{type:W}}var G=a(1034),U=a(64),V=a.n(U),_=Object(G.a)(function(e){return{chip:{marginLeft:e.spacing(1),padding:2,background:"#ef5350",color:"white",fontWeight:"bold",fontSize:"11px",height:20},chip2:{marginLeft:e.spacing(1),padding:2,background:"#4caf50",color:"white",fontWeight:"bold",fontSize:"11px",height:20},chipOrange:{marginLeft:e.spacing(1),padding:2,background:"#ff9800",color:"white",fontWeight:"bold",fontSize:"11px",height:20}}});var B=function(e){var t=Object(o.b)(),a=Object(o.c)(function(e){return e.commandesApp.commandes.entities}),c=Object(o.c)(function(e){return e.commandesApp.commandes.searchText}),v=_(),C=Object(o.c)(function(e){return e.commandesApp.commandes.parametres}),N=Object(o.c)(function(e){return e.commandesApp.commandes.loading}),M=Object(o.c)(function(e){return e.commandesApp.commandes.pageCount}),P=Object(n.useState)(null),D=Object(l.a)(P,2),S=D[0],w=D[1];if(Object(n.useEffect)(function(){a&&w(function(e,t){var a=Object.keys(e).map(function(t){return e[t]});return 0===t.length?a:i.y.filterArrayByString(a,t)}(a,c))},[a,c]),!S)return null;var T=A.a.debounce(function(e){return t(z(e))},1e3);return r.a.createElement(i.d,{animation:"transition.slideUpIn",delay:300},r.a.createElement(h.b,{className:"-striped -highlight h-full sm:rounded-16 overflow-hidden",getTrProps:function(e,a,n){return{className:"cursor-pointer",onClick:function(e,n){var r;a&&t((r=a.original,{type:x,data:r}))}}},getTheadProps:function(e,t,a){return{className:"h-64 font-bold"}},data:S,columns:[{Header:"Nombre de jetons",filterable:!0,accessor:"nbrJeton"},{Header:"Fournisseur",filterable:!0,className:"font-bold",accessor:"fournisseur.societe",Cell:function(e){return e.original.fournisseur?e.original.fournisseur.societe:""}},{Header:"Etat",accessor:"isUse",filterable:!0,Cell:function(e){return e.original.isUse?r.a.createElement(s.a,{className:v.chip2,label:"Trait\xe9e"}):r.a.createElement(s.a,{className:v.chipOrange,label:"En attente"})},Filter:function(e){var t=e.filter,a=e.onChange;return r.a.createElement("select",{onChange:function(e){return a(e.target.value)},style:{width:"100%"},value:t?t.value:""},r.a.createElement("option",{value:""},"Tous"),r.a.createElement("option",{value:"true"},"Trait\xe9e"),r.a.createElement("option",{value:"false"},"En attente"))}},{Header:"Date de cr\xe9ation",accessor:"created",filterable:!0,Cell:function(e){return V()(e.original.created).format("DD/MM/YYYY HH:mm")},Filter:function(e){var t=e.filter,a=e.onChange;return r.a.createElement(u.a,{onChange:function(e){return a(e.target.value)},style:{width:"100%"},value:t?t.value:"",type:"date",InputLabelProps:{shrink:!0}})}},{Header:"",sortable:!1,width:64,Cell:function(e){return r.a.createElement("div",{className:"flex items-center"},r.a.createElement(m.a,{className:"text-red text-20",onClick:function(a){var n;a.stopPropagation(),t((n={children:r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{id:"alert-dialog-title"},"Suppression"),r.a.createElement(p.a,null,r.a.createElement(f.a,{id:"alert-dialog-description"},e.original.isUse?"Vous ne pouvez pas supprimer cet enregistrement, car il est trait\xe9!":"Voulez vous vraiment supprimer cet enregistrement ?")),r.a.createElement(b.a,null,r.a.createElement(E.a,{onClick:function(){return t(H())},color:"primary"},"Non"),e.original.isUse?r.a.createElement(E.a,{disabled:!0,color:"primary",autoFocus:!0},"Oui"):r.a.createElement(E.a,{onClick:function(a){var n,r;t((n=e.original,r=C,function(e,t){return O.a.delete(n["@id"]).then(function(t){return Promise.all([e({type:I}),e(Object(y.B)({message:"Commande bien supprim\xe9!",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"success"})),e(j.b("commandes-jetons")),e(j.b("abonnement-fournisseur"))]).then(function(){return e(J(r))})})})),t(H())},color:"primary",autoFocus:!0},"Oui")))},{type:R,options:n}))}},r.a.createElement(g.a,null,"delete")))}}],manual:!0,defaultSortDesc:!0,pages:M,page:C.page-1,defaultPageSize:10,loading:N,showPageSizeOptions:!1,onPageChange:function(e){C.page=e+1,t(z(C))},onSortedChange:function(e,a,n){C.page=1,C.filter.id=e[0].id,C.filter.direction=e[0].desc?"desc":"asc",t(z(C))},onFilteredChange:function(e){C.page=1,C.search=e,T(C)},noDataText:"Aucune commande trouv\xe9e",loadingText:"Chargement...",ofText:"sur"}))},Y=a(98);var q=function(e){return r.a.createElement("div",{className:"flex flex-1 items-center justify-between p-8 sm:p-24"},r.a.createElement("div",{className:"flex items-center"},r.a.createElement(i.d,{animation:"transition.expandIn",delay:300},r.a.createElement(g.a,{className:"text-32 mr-0 sm:mr-12"},"control_point_duplicate")),r.a.createElement(i.d,{animation:"transition.slideLeftIn",delay:300},r.a.createElement(Y.a,{className:"hidden sm:flex",variant:"h6"},"Liste des commandes"))))},Q=a(8),X=a(1031),K=a(1026),Z=a(1036),$=a(1023),ee=a(1046),te=a(141),ae=a(55),ne=a.n(ae),re={name:""};var ie=function(e){var t=Object(o.b)(),a=Object(o.c)(function(e){return e.commandesApp.commandes.commandesDialog}),c=Object(o.c)(function(e){return e.commandesApp.commandes.paiements}),s=Object(o.c)(function(e){return e.commandesApp.commandes.parametres}),u=Object(te.b)(re),m=u.form,d=u.handleChange,f=u.setForm,g=Object(n.useState)(!1),h=Object(l.a)(g,2),C=h[0],N=h[1],M=Object(n.useRef)(null),x=Object(n.useCallback)(function(){"edit"===a.type&&a.data&&(a.data.prix=100*a.data.nbrJeton,f(Object(Q.a)({},a.data))),"new"===a.type&&f(Object(Q.a)({},re,a.data))},[a.data,a.type,f]);function T(){"edit"===a.type?t({type:D}):t({type:P})}return Object(n.useEffect)(function(){a.props.open&&x()},[a.props.open,x]),r.a.createElement(X.a,Object.assign({classes:{paper:"m-24"}},a.props,{onClose:T,fullWidth:!0,maxWidth:"xs"}),r.a.createElement(K.a,{position:"static",elevation:1},r.a.createElement(Z.a,{className:"flex w-full"},r.a.createElement(Y.a,{variant:"subtitle1",color:"inherit"},"new"===a.type?"Nouvelle Commande":"Editer Commande"))),r.a.createElement(ne.a,{onValidSubmit:function(){"edit"===a.type&&t(function(e,t){var a={fournisseur:e.fournisseur["@id"],paiement:e.paiement.value,demande:e["@id"],nbrJeton:e.nbrJeton,prix:parseFloat(e.prix),isPayed:e.isPayed};return function(e,n){return O.a.post("/api/jetons",a).then(function(a){return Promise.all([e({type:S}),e(Object(y.B)({message:"Jetons bien effuctu\xe9!",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"success"})),e(j.b("commandes-jetons")),e(j.b("abonnement-fournisseur"))]).then(function(){return e(J(t))})}).catch(function(t){e({type:w}),e(Object(y.B)({message:A.a.map(v.a.parseApiErrors(t),function(e,t){return t+": "+e}),autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"right"},variant:"error"}))})}}(m,s)),T()},onValid:function(){N(!0)},onInvalid:function(){N(!1)},ref:M,className:"flex flex-col overflow-hidden"},r.a.createElement(p.a,{classes:{root:"p-24"}},r.a.createElement("div",{className:"flex"},r.a.createElement(i.F,{className:"mb-24",id:"reference",name:"reference",label:"Fournisseur",value:m.fournisseur?m.fournisseur.societe:"",InputProps:{readOnly:!0},fullWidth:!0})),r.a.createElement("div",{className:"flex"},r.a.createElement(i.C,{className:"inline",name:"nbrJeton",label:"Nombre de jetons"},r.a.createElement($.a,{value:"5",disabled:!0,checked:5===m.nbrJeton,control:r.a.createElement(ee.a,null),label:"5"}),r.a.createElement($.a,{value:"10",disabled:!0,checked:10===m.nbrJeton,control:r.a.createElement(ee.a,null),label:"10"}),r.a.createElement($.a,{value:"20",disabled:!0,checked:20===m.nbrJeton,control:r.a.createElement(ee.a,null),label:"20"}))),r.a.createElement("div",{className:"flex"},r.a.createElement(i.F,{className:"mb-24 mt-24",type:"number",step:"any",label:"Prix",id:"prix",name:"prix",min:"0",value:String(100*m.nbrJeton),onChange:d,variant:"outlined",inputProps:{min:"0",step:"any"},fullWidth:!0,required:!0})),r.a.createElement("div",{className:"flex"},r.a.createElement(i.E,{id:"paiement",name:"paiement",className:"MuiFormControl-fullWidth MuiTextField-root mb-24 z-9999",value:m.paiement,onChange:function(e){return function(e,t){f(A.a.set(Object(Q.a)({},m),t,e))}(e,"paiement")},textFieldProps:{label:"Choisissez le mode de paiement",InputLabelProps:{shrink:!0},variant:"outlined"},options:c,fullWidth:!0,required:!0})),r.a.createElement("div",{className:"flex"},r.a.createElement(i.a,{className:"mb-10",name:"isPayed",onChange:function(e){return function(e,t){f(A.a.set(Object(Q.a)({},m),t,e.target.checked))}(e,"isPayed")},label:"Confirmer le paiement de cette entreprise"}))),"new"===a.type?"":r.a.createElement(b.a,{className:"justify-between pl-16"},m.isUse?"":r.a.createElement(E.a,{variant:"contained",color:"primary",type:"submit",disabled:!C},"Mettre \xe0 jour"))))},oe=a(46),ce={entities:null,paiements:null,parametres:{page:1,search:[],filter:{id:"created",direction:"desc"}},pageCount:null,loading:!1,searchText:"",selectedCommandesIds:[],routeParams:{},commandesDialog:{type:"new",props:{open:!1},data:null}},le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return Object(Q.a)({},e,{parametres:{page:t.parametres.page,search:t.parametres.search,filter:{id:t.parametres.filter.id,direction:t.parametres.filter.direction}}});case k:return Object(Q.a)({},ce);case T:return Object(Q.a)({},e,{loading:!0});case C:return Object(Q.a)({},e,{entities:t.payload["hydra:member"],pageCount:v.a.hydraPageCount(t.payload),loading:!1});case F:return Object(Q.a)({},e,{paiements:t.payload});case N:return Object(Q.a)({},e,{searchText:t.searchText});case M:return Object(Q.a)({},e,{commandesDialog:{type:"new",props:{open:!0},data:null}});case P:return Object(Q.a)({},e,{commandesDialog:{type:"new",props:{open:!1},data:null}});case x:return Object(Q.a)({},e,{commandesDialog:{type:"edit",props:{open:!0},data:t.data}});case D:return Object(Q.a)({},e,{commandesDialog:{type:"edit",props:{open:!1},data:null}});default:return e}},se={state:!1,options:{children:"Hi"}},ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y.f:return Object(Q.a)({},e,{state:!0,options:Object(Q.a)({},e.options,t.options)});case y.a:return Object(Q.a)({},e,{state:!1});default:return e}},me=Object(oe.d)({commandes:le,dialog:ue}),de=a(346);t.default=Object(c.a)("commandesApp",me)(function(e){var t=Object(o.b)(),a=Object(n.useRef)(null),c=Object(o.c)(function(e){return e.commandesApp.commandes.parametres}),l=Object(o.c)(function(e){return e.commandesApp.commandes.paiements});return Object(n.useEffect)(function(){t(J(c)),l||t(function(){var e=O.a.get("/api/paiements");return function(t){return e.then(function(e){t({type:F,payload:e.data["hydra:member"]})})}}())},[t,c]),r.a.createElement(r.a.Fragment,null,r.a.createElement(de.Helmet,null,r.a.createElement("title",null,"Commande jetons | Les Achats Industriels"),r.a.createElement("meta",{name:"robots",content:"noindex, nofollow"}),r.a.createElement("meta",{name:"googlebot",content:"noindex"})),r.a.createElement(i.p,{classes:{contentWrapper:"p-0 sm:p-24 pb-80 sm:pb-80 h-full",content:"flex flex-col h-full",leftSidebar:"w-256 border-0",header:"min-h-72 h-72 sm:h-136 sm:min-h-136"},header:r.a.createElement(q,{pageLayout:a}),content:r.a.createElement(B,null),sidebarInner:!0,ref:a,innerScroll:!0}),r.a.createElement(ie,null))})}}]);