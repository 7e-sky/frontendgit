(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{1244:function(e,a,t){"use strict";var n=t(3),r=t.n(n),l=t(4),o=t.n(l),i=t(0),s=t.n(i),c=t(2),m=t(8),d=t(89),p=s.a.forwardRef(function(e,a){var t=e.children,n=e.classes,l=e.className,i=e.disableTypography,m=void 0!==i&&i,p=o()(e,["children","classes","className","disableTypography"]);return s.a.createElement("div",r()({className:Object(c.a)(n.root,l),ref:a},p),m?t:s.a.createElement(d.a,{variant:"h6"},t))});a.a=Object(m.a)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(p)},1245:function(e,a,t){"use strict";var n=t(3),r=t.n(n),l=t(0),o=t.n(l),i=t(8),s=t(89),c=o.a.forwardRef(function(e,a){return o.a.createElement(s.a,r()({component:"p",variant:"body1",color:"textSecondary",ref:a},e))});a.a=Object(i.a)({root:{marginBottom:16}},{name:"MuiDialogContentText"})(c)},1544:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),l=t(39),o=t(7),i=t(136),s=t(1160),c=t(1151),m=t(1140),d=t(1244),p=t(1229),u=t(1245),f=t(1230),E=t(1227),g=t(1204),b=t(365),h=t(50),O=t(102),v=t(33),y=t(10),A=t(200);const C="[COMMANDES APP] GET COMMANDES",N="[COMMANDES APP] SET SEARCH TEXT",M="[COMMANDES APP] OPEN NEW COMMANDES DIALOG",P="[COMMANDES APP] CLOSE NEW COMMANDES DIALOG",x="[COMMANDES APP] OPEN EDIT COMMANDES DIALOG",D="[COMMANDES APP] CLOSE EDIT COMMANDES DIALOG",S="[COMMANDES APP] ADD COMMANDE",j="[COMMANDES APP] SAVE ERROR",w="[COMMANDES APP] REQUEST_COMMANDES",T="[COMMANDES APP] REMOVE COMMANDE",I="[COMMANDES APP] SET PARAMETRES DATA",L="[COMMANDES APP] CLEAN_UP",k="[COMMANDES APP] GET_PAIEMENT";function F(e){return{type:I,parametres:e}}function z(e){var a="";e.search.length>0&&e.search.map(e=>e.value&&("created"===e.id?a+="&"+e.id+"[after]="+e.value:a+="&"+e.id+"="+e.value));const t=h.a.get("/api/demande_jetons?page=".concat(e.page).concat(a,"&order[").concat(e.filter.id,"]=").concat(e.filter.direction));return e=>(e({type:w}),t.then(a=>{e({type:C,payload:a.data})}))}const J="[DIALOG] OPEN",R="[DIALOG] CLOSE";function W(){return{type:R}}var H=t(1226),G=t(59),U=t.n(G);const V=Object(H.a)(e=>({chip:{marginLeft:e.spacing(1),padding:2,background:"#ef5350",color:"white",fontWeight:"bold",fontSize:"11px",height:20},chip2:{marginLeft:e.spacing(1),padding:2,background:"#4caf50",color:"white",fontWeight:"bold",fontSize:"11px",height:20},chipOrange:{marginLeft:e.spacing(1),padding:2,background:"#ff9800",color:"white",fontWeight:"bold",fontSize:"11px",height:20}}));var _=function(e){const a=Object(o.b)(),t=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.entities}),i=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.searchText}),O=V(),C=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.parametres}),N=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.loading}),M=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.pageCount}),[P,D]=Object(n.useState)(null);if(Object(n.useEffect)(()=>{t&&D(function(e,a){const t=Object.keys(e).map(a=>e[a]);return 0===a.length?t:l.y.filterArrayByString(t,a)}(t,i))},[t,i]),!P)return null;const S=y.a.debounce(e=>a(F(e)),1e3);return r.a.createElement(l.d,{animation:"transition.slideUpIn",delay:300},r.a.createElement(b.b,{className:"-striped -highlight h-full sm:rounded-16 overflow-hidden",getTrProps:(e,t,n)=>({className:"cursor-pointer",onClick:(e,n)=>{t&&a(function(e){return{type:x,data:e}}(t.original))}}),getTheadProps:(e,a,t)=>({className:"h-64 font-bold"}),data:P,columns:[{Header:"Nombre de jetons",filterable:!0,accessor:"nbrJeton"},{Header:"Fournisseur",filterable:!0,className:"font-bold",accessor:"fournisseur.societe",Cell:e=>e.original.fournisseur?e.original.fournisseur.societe:""},{Header:"Etat",accessor:"isUse",filterable:!0,Cell:e=>e.original.isUse?r.a.createElement(s.a,{className:O.chip2,label:"Trait\xe9e"}):r.a.createElement(s.a,{className:O.chipOrange,label:"En attente"}),Filter:e=>{let{filter:a,onChange:t}=e;return r.a.createElement("select",{onChange:e=>t(e.target.value),style:{width:"100%"},value:a?a.value:""},r.a.createElement("option",{value:""},"Tous"),r.a.createElement("option",{value:"true"},"Trait\xe9e"),r.a.createElement("option",{value:"false"},"En attente"))}},{Header:"Date de cr\xe9ation",accessor:"created",filterable:!0,Cell:e=>U()(e.original.created).format("DD/MM/YYYY HH:mm"),Filter:e=>{let{filter:a,onChange:t}=e;return r.a.createElement(c.a,{onChange:e=>t(e.target.value),style:{width:"100%"},value:a?a.value:"",type:"date",InputLabelProps:{shrink:!0}})}},{Header:"",sortable:!1,width:64,Cell:e=>r.a.createElement("div",{className:"flex items-center"},r.a.createElement(m.a,{className:"text-red text-20",onClick:t=>{t.stopPropagation(),a(function(e){return{type:J,options:e}}({children:r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,{id:"alert-dialog-title"},"Suppression"),r.a.createElement(p.a,null,r.a.createElement(u.a,{id:"alert-dialog-description"},e.original.isUse?"Vous ne pouvez pas supprimer cet enregistrement, car il est trait\xe9!":"Voulez vous vraiment supprimer cet enregistrement ?")),r.a.createElement(f.a,null,r.a.createElement(E.a,{onClick:()=>a(W()),color:"primary"},"Non"),e.original.isUse?r.a.createElement(E.a,{disabled:!0,color:"primary",autoFocus:!0},"Oui"):r.a.createElement(E.a,{onClick:t=>{a(function(e,a){return(t,n)=>h.a.delete(e["@id"]).then(e=>Promise.all([t({type:T}),t(Object(v.B)({message:"Commande bien supprim\xe9!",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"success"})),t(A.b("commandes-jetons")),t(A.b("abonnement-fournisseur"))]).then(()=>t(z(a))))}(e.original,C)),a(W())},color:"primary",autoFocus:!0},"Oui")))}))}},r.a.createElement(g.a,null,"delete")))}],manual:!0,defaultSortDesc:!0,pages:M,page:C.page-1,defaultPageSize:10,loading:N,showPageSizeOptions:!1,onPageChange:e=>{C.page=e+1,a(F(C))},onSortedChange:(e,t,n)=>{C.page=1,C.filter.id=e[0].id,C.filter.direction=e[0].desc?"desc":"asc",a(F(C))},onFilteredChange:e=>{C.page=1,C.search=e,S(C)},noDataText:"Aucune commande trouv\xe9e",loadingText:"Chargement...",ofText:"sur"}))},B=t(89);var Y=function(e){return r.a.createElement("div",{className:"flex flex-1 items-center justify-between p-8 sm:p-24"},r.a.createElement("div",{className:"flex items-center"},r.a.createElement(l.d,{animation:"transition.expandIn",delay:300},r.a.createElement(g.a,{className:"text-32 mr-0 sm:mr-12"},"control_point_duplicate")),r.a.createElement(l.d,{animation:"transition.slideLeftIn",delay:300},r.a.createElement(B.a,{className:"hidden sm:flex",variant:"h6"},"Liste des commandes"))))},q=t(1223),Q=t(1218),X=t(1228),K=t(1215),Z=t(1238),$=t(137),ee=t(51),ae=t.n(ee);const te={name:""};var ne=function(e){const a=Object(o.b)(),t=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.commandesDialog}),i=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.paiements}),s=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.parametres}),{form:c,handleChange:m,setForm:d}=Object($.b)(te),[u,g]=Object(n.useState)(!1),b=Object(n.useRef)(null),C=Object(n.useCallback)(()=>{"edit"===t.type&&t.data&&(t.data.prix=100*t.data.nbrJeton,d({...t.data})),"new"===t.type&&d({...te,...t.data})},[t.data,t.type,d]);function N(){"edit"===t.type?a({type:D}):a({type:P})}return Object(n.useEffect)(()=>{t.props.open&&C()},[t.props.open,C]),r.a.createElement(q.a,Object.assign({classes:{paper:"m-24"}},t.props,{onClose:N,fullWidth:!0,maxWidth:"xs"}),r.a.createElement(Q.a,{position:"static",elevation:1},r.a.createElement(X.a,{className:"flex w-full"},r.a.createElement(B.a,{variant:"subtitle1",color:"inherit"},"new"===t.type?"Nouvelle Commande":"Editer Commande"))),r.a.createElement(ae.a,{onValidSubmit:function(){"edit"===t.type&&a(function(e,a){let t={fournisseur:e.fournisseur["@id"],paiement:e.paiement.value,demande:e["@id"],nbrJeton:e.nbrJeton,prix:parseFloat(e.prix),isPayed:e.isPayed};return(e,n)=>h.a.post("/api/jetons",t).then(t=>Promise.all([e({type:S}),e(Object(v.B)({message:"Jetons bien effuctu\xe9!",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"success"})),e(A.b("commandes-jetons")),e(A.b("abonnement-fournisseur"))]).then(()=>e(z(a)))).catch(a=>{e({type:j}),e(Object(v.B)({message:y.a.map(O.a.parseApiErrors(a),function(e,a){return a+": "+e}),autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"right"},variant:"error"}))})}(c,s)),N()},onValid:function(){g(!0)},onInvalid:function(){g(!1)},ref:b,className:"flex flex-col overflow-hidden"},r.a.createElement(p.a,{classes:{root:"p-24"}},r.a.createElement("div",{className:"flex"},r.a.createElement(l.F,{className:"mb-24",id:"reference",name:"reference",label:"Fournisseur",value:c.fournisseur?c.fournisseur.societe:"",InputProps:{readOnly:!0},fullWidth:!0})),r.a.createElement("div",{className:"flex"},r.a.createElement(l.C,{className:"inline",name:"nbrJeton",label:"Nombre de jetons"},r.a.createElement(K.a,{value:"5",disabled:!0,checked:5===c.nbrJeton,control:r.a.createElement(Z.a,null),label:"5"}),r.a.createElement(K.a,{value:"10",disabled:!0,checked:10===c.nbrJeton,control:r.a.createElement(Z.a,null),label:"10"}),r.a.createElement(K.a,{value:"20",disabled:!0,checked:20===c.nbrJeton,control:r.a.createElement(Z.a,null),label:"20"}))),r.a.createElement("div",{className:"flex"},r.a.createElement(l.F,{className:"mb-24 mt-24",type:"number",step:"any",label:"Prix",id:"prix",name:"prix",min:"0",value:String(100*c.nbrJeton),onChange:m,variant:"outlined",inputProps:{min:"0",step:"any"},fullWidth:!0,required:!0})),r.a.createElement("div",{className:"flex"},r.a.createElement(l.E,{id:"paiement",name:"paiement",className:"MuiFormControl-fullWidth MuiTextField-root mb-24 z-9999",value:c.paiement,onChange:e=>(function(e,a){d(y.a.set({...c},a,e))})(e,"paiement"),textFieldProps:{label:"Choisissez le mode de paiement",InputLabelProps:{shrink:!0},variant:"outlined"},options:i,fullWidth:!0,required:!0})),r.a.createElement("div",{className:"flex"},r.a.createElement(l.a,{className:"mb-10",name:"isPayed",onChange:e=>(function(e,a){d(y.a.set({...c},a,e.target.checked))})(e,"isPayed"),label:"Confirmer le paiement de cette entreprise"}))),"new"===t.type?"":r.a.createElement(f.a,{className:"justify-between pl-16"},c.isUse?"":r.a.createElement(E.a,{variant:"contained",color:"primary",type:"submit",disabled:!u},"Mettre \xe0 jour"))))},re=t(43);const le={entities:null,paiements:null,parametres:{page:1,search:[],filter:{id:"created",direction:"desc"}},pageCount:null,loading:!1,searchText:"",selectedCommandesIds:[],routeParams:{},commandesDialog:{type:"new",props:{open:!1},data:null}};var oe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case I:return{...e,parametres:{page:a.parametres.page,search:a.parametres.search,filter:{id:a.parametres.filter.id,direction:a.parametres.filter.direction}}};case L:return{...le};case w:return{...e,loading:!0};case C:return{...e,entities:a.payload["hydra:member"],pageCount:O.a.hydraPageCount(a.payload),loading:!1};case k:return{...e,paiements:a.payload};case N:return{...e,searchText:a.searchText};case M:return{...e,commandesDialog:{type:"new",props:{open:!0},data:null}};case P:return{...e,commandesDialog:{type:"new",props:{open:!1},data:null}};case x:return{...e,commandesDialog:{type:"edit",props:{open:!0},data:a.data}};case D:return{...e,commandesDialog:{type:"edit",props:{open:!1},data:null}};default:return e}};const ie={state:!1,options:{children:"Hi"}};var se=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case v.f:return{...e,state:!0,options:{...e.options,...a.options}};case v.a:return{...e,state:!1};default:return e}};var ce=Object(re.d)({commandes:oe,dialog:se}),me=t(364);a.default=Object(i.a)("commandesApp",ce)(function(e){const a=Object(o.b)(),t=Object(n.useRef)(null),i=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.parametres}),s=Object(o.c)(e=>{let{commandesApp:a}=e;return a.commandes.paiements});return Object(n.useEffect)(()=>{a(z(i)),s||a(function(){const e=h.a.get("/api/paiements");return a=>e.then(e=>{a({type:k,payload:e.data["hydra:member"]})})}())},[a,i]),r.a.createElement(r.a.Fragment,null,r.a.createElement(me.Helmet,null,r.a.createElement("title",null,"Commande jetons | Les Achats Industriels"),r.a.createElement("meta",{name:"robots",content:"noindex, nofollow"}),r.a.createElement("meta",{name:"googlebot",content:"noindex"})),r.a.createElement(l.p,{classes:{contentWrapper:"p-0 sm:p-24 pb-80 sm:pb-80 h-full",content:"flex flex-col h-full",leftSidebar:"w-256 border-0",header:"min-h-72 h-72 sm:h-136 sm:min-h-136"},header:r.a.createElement(Y,{pageLayout:t}),content:r.a.createElement(_,null),sidebarInner:!0,ref:t,innerScroll:!0}),r.a.createElement(ne,null))})}}]);