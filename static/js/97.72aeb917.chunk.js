(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{1284:function(e,a,t){"use strict";var n=t(50),l=t(59),r=t.n(l);const s="[CONSULTATIONS FOURNISSEUR APP] REQUEST CONSULTATIONS",c="[CONSULTATIONS FOURNISSEUR APP] SET PARAMETRES DATA",i="[USERS APP] GET CONSULTATIONS",d="[USERS APP] SET CONSULTATIONS SEARCH TEXT";function m(e,a){var t="";e.search.length>0&&e.search.map(function(e,a){e.value&&("created"===e.id||"dateExpiration"===e.id?t+="&"+e.id+"[after]="+e.value:"demande.statut"===e.id?"1"===e.value?t+="&demande.statut=1&demande.dateExpiration[strictly_after]=".concat(r()().format("YYYY-MM-DDTHH:mm:ss")):"3"===e.value&&(t+="&demande.dateExpiration[strictly_before]=".concat(r()().format("YYYY-MM-DDTHH:mm:ss"))):t+="&"+e.id+"="+e.value)});const l=n.a.get("/api/detail_visites?page=".concat(e.page).concat(t,"&fournisseur=").concat(a,"&order[").concat(e.filter.id,"]=").concat(e.filter.direction));return e=>(e({type:s}),l.then(a=>e({type:i,payload:a.data})))}function o(e){return{type:c,parametres:e}}var u=t(39),p=t(33);const E="[CONSULTATION FOURNISSEUR APP] REQUEST CONSULTATION",f="[CONSULTATION FOURNISSEUR APP] GET CONSULTATION",h="[CONSULTATION FOURNISSEUR APP] GET_PERSONNELS",b="[CONSULTATION FOURNISSEUR APP] REQUEST SAVE",N="[CONSULTATION FOURNISSEUR APP] SAVE CONSULTANTION",g="[CONSULTATION FOURNISSEUR APP] SAVE ERROR",x="[CONSULTATION FOURNISSEUR APP] CLEAN_UP";function y(){return e=>e({type:x})}function v(e){const a=n.a.get("/api/detail_visites/".concat(e));return e=>(e({type:E}),a.then(a=>{e({type:f,payload:a.data})}))}function O(e){const a=n.a.get("/api/fournisseurs/".concat(e,"/personnels"));return e=>a.then(a=>{e({type:h,payload:a.data["hydra:member"]})})}function S(e){let a={budget:parseFloat(e.budget),personnel:e.personnel?e.personnel.value:null,sendEmail:!!e.sendEmail&&e.sendEmail};const t=n.a.put(e["@id"],a);return e=>(e({type:b}),t.then(a=>(e(Object(p.B)({message:"Consultation Modifi\xe9e"})),e({type:N,payload:a.data}))).catch(a=>{e({type:g,payload:u.y.parseApiErrors(a)})}))}t.d(a,"f",function(){return s}),t.d(a,"k",function(){return c}),t.d(a,"c",function(){return i}),t.d(a,"j",function(){return d}),t.d(a,"n",function(){return m}),t.d(a,"q",function(){return o}),t.d(a,"e",function(){return E}),t.d(a,"b",function(){return f}),t.d(a,"d",function(){return h}),t.d(a,"g",function(){return b}),t.d(a,"h",function(){return N}),t.d(a,"i",function(){return g}),t.d(a,"a",function(){return x}),t.d(a,"l",function(){return y}),t.d(a,"m",function(){return v}),t.d(a,"o",function(){return O}),t.d(a,"p",function(){return S})},1350:function(e,a,t){"use strict";var n=t(43),l=t(1284),r=t(102);const s={data:[],pageCount:null,loading:!1,searchText:"",parametres:{page:1,description:"",search:[],filter:{id:"created",direction:"desc"}}};var c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case l.f:return{...e,loading:!0};case l.c:return{...e,data:a.payload["hydra:member"],pageCount:r.a.hydraPageCount(a.payload),loading:!1};case l.j:return{...e,searchText:a.searchText};case l.k:return{...e,parametres:{page:a.parametres.page,search:a.parametres.search,description:a.parametres.description,filter:{id:a.parametres.filter.id,direction:a.parametres.filter.direction}}};default:return e}};const i={data:null,error:null,loading:!1,personnels:null,request:!1};var d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case l.e:return{...e,loading:!0};case l.g:return{...e,request:!0};case l.a:return{...e,data:null,loading:!1,error:null};case l.b:return{...e,data:a.payload,loading:!1};case l.d:return{...e,personnels:a.payload};case l.h:return{...e,request:!1};case l.i:return{...e,error:a.payload,loading:!1};default:return e}};const m=Object(n.d)({consultations:c,consultation:d});a.a=m},1520:function(e,a,t){"use strict";t.r(a);var n=t(0),l=t.n(n),r=t(89),s=t(1204),c=t(1224),i=t(1236),d=t(1219),m=t(1232),o=t(1231),u=t(1215),p=t(1238),E=t(1227),f=t(1233),h=t(1212),b=t(163),N=t(1157),g=t(39),x=t(16),y=t(2),v=t(10),O=t(7),S=t(136),I=t(1284),P=t(1350),T=t(51),A=t.n(T),F=t(59),w=t.n(F),U=t(1160),R=t(137);const C=Object(N.a)(e=>({root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}},consultationImageFeaturedStar:{position:"absolute",top:0,right:0,color:b.a[400],opacity:0},consultationImageUpload:{transitionProperty:"box-shadow",transitionDuration:e.transitions.duration.short,transitionTimingFunction:e.transitions.easing.easeInOut},consultationImageItem:{transitionProperty:"box-shadow",transitionDuration:e.transitions.duration.short,transitionTimingFunction:e.transitions.easing.easeInOut,"&:hover":{"& $consultationImageFeaturedStar":{opacity:.8}},"&.featured":{pointerEvents:"none",boxShadow:e.shadows[3],"& $consultationImageFeaturedStar":{opacity:1},"&:hover $consultationImageFeaturedStar":{opacity:1}}},error:{backgroundColor:e.palette.error.dark},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:e.spacing(1)},message:{display:"flex",alignItems:"center"},margin:{margin:e.spacing(1)},chip:{marginLeft:e.spacing(1),background:"#ef5350",color:"white",fontWeight:"bold",fontSize:"11px"},chip2:{marginLeft:e.spacing(1),background:"#4caf50",color:"white",fontWeight:"bold",fontSize:"11px"},chip3:{margin:e.spacing(1),background:"green",color:"white",fontWeight:"bold",fontSize:"11px"}}));a.default=Object(S.a)("consultationsFrsApp",P.a)(function(e){const[a,t]=Object(n.useState)(!1),[b,N]=Object(n.useState)(!1),S=Object(n.useRef)(null),{form:P,handleChange:T,setForm:F}=Object(R.b)(null),j=Object(O.b)(),W=Object(O.c)(e=>{let{consultationsFrsApp:a}=e;return a.consultation}),L=Object(O.c)(e=>{let{auth:a}=e;return a.user}),k=C(e),[Y,D]=Object(n.useState)(0),[_,q]=Object(n.useState)(1);return Object(n.useEffect)(()=>{j(I.o(L.id))},[j,L.id]),Object(n.useEffect)(()=>{const a=e.match.params,{consultationId:t}=a;return j(I.m(t)),()=>{j(I.l())}},[j,e.match.params]),Object(n.useEffect)(()=>{(W.data&&!P||W.data&&P&&W.data.id!==P.id)&&(F({...W.data}),W.data.personnel&&t({value:W.data.personnel["@id"],label:W.data.personnel.name}))},[P,W.data,F]),l.a.createElement(g.o,{classes:{toolbar:"p-0",header:"min-h-72 h-72 sm:h-136 sm:min-h-136"},header:W.loading?"":W.data&&l.a.createElement("div",{className:"flex flex-1 w-full items-center justify-between"},l.a.createElement("div",{className:"flex flex-col items-start max-w-full"},l.a.createElement(g.d,{animation:"transition.slideRightIn",delay:300},l.a.createElement(r.a,{className:"normal-case flex items-center sm:mb-12",component:x.a,role:"button",to:"/consultations",color:"inherit"},l.a.createElement(s.a,{className:"mr-4 text-20"},"arrow_back"),"Retour")),l.a.createElement("div",{className:"flex items-center max-w-full"},l.a.createElement("div",{className:"flex flex-col min-w-0"},l.a.createElement(g.d,{animation:"transition.slideLeftIn",delay:300},l.a.createElement("div",{className:"text-16 sm:text-20 truncate"},W.data.demande.reference?"RFQ-"+W.data.demande.reference:"",w()(W.data.demande.dateExpiration)>=w()()?0===W.data.demande.statut?l.a.createElement(U.a,{className:k.chipOrange,label:"En attente"}):1===W.data.demande.statut?l.a.createElement(U.a,{className:k.chip2,label:"En cours"}):l.a.createElement(U.a,{className:k.chip,label:"Refus\xe9e"}):l.a.createElement(U.a,{className:k.chip,label:"Expir\xe9e"}),w()(W.data.demande.dateExpiration)>=w()()?l.a.createElement(U.a,{className:k.chip2,label:0===w()(W.data.demande.dateExpiration).diff(w()(),"days")?w()(W.data.demande.dateExpiration).diff(w()(),"hours")+" h":w()(W.data.demande.dateExpiration).diff(w()(),"days")+" j"}):l.a.createElement(U.a,{className:k.chip,label:0===w()(W.data.demande.dateExpiration).diff(w()(),"days")?w()(W.data.demande.dateExpiration).diff(w()(),"hours")+" h":w()(W.data.demande.dateExpiration).diff(w()(),"days")+" j"}))))))),contentToolbar:W.loading?l.a.createElement("div",{className:k.root},l.a.createElement(c.a,{color:"secondary"})):l.a.createElement(i.a,{value:Y,onChange:function(e,a){D(a)},indicatorColor:"secondary",textColor:"secondary",variant:"scrollable",scrollButtons:"auto",classes:{root:"w-full h-64"}},l.a.createElement(d.a,{className:"h-64 normal-case",label:"Infos g\xe9n\xe9rales"}),l.a.createElement(d.a,{className:"h-64 normal-case",label:W.data&&W.data.demande.attachements.length>0?"Pi\xe8ce(s) jointe(s) ("+W.data.demande.attachements.length+")":"Pi\xe8ce(s) jointe(s)"}),W.data?l.a.createElement(d.a,{className:"h-64 normal-case text-orange font-bold",label:"Profil Acheteur"}):""),content:W.loading?"":P&&l.a.createElement("div",{className:"p-10  sm:p-24 max-w-2xl"},0===Y&&l.a.createElement(A.a,{onValidSubmit:function(e){j(I.p(P))},onValid:function(){N(!0)},onInvalid:function(){N(!1)},ref:S,className:"flex flex-col "},l.a.createElement(m.a,{container:!0,spacing:3},l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.F,{className:"mb-24",label:"R\xe9f\xe9rence",id:"reference",name:"reference",value:W.data.demande.reference,InputProps:{readOnly:!0,startAdornment:l.a.createElement(o.a,{position:"start"},"RFQ-")},fullWidth:!0})),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.F,{className:"mb-24",label:"Date d'expiration",id:"dateExpiration",name:"dateExpiration",value:w()(W.data.demande.dateExpiration).format("DD/MM/YYYY HH:mm"),InputProps:{readOnly:!0},fullWidth:!0})),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.F,{className:"mb-24",label:"Date de cr\xe9ation",id:"dateCreated",name:"dateCreated",value:w()(W.data.demande.created).format("DD/MM/YYYY HH:mm"),InputProps:{readOnly:!0},fullWidth:!0}))),l.a.createElement(m.a,{container:!0,spacing:3},l.a.createElement(m.a,{item:!0,xs:12,sm:12},l.a.createElement(g.F,{className:"mb-24",label:"Activit\xe9s",id:"sousSecteurs",name:"sousSecteurs",value:v.a.join(v.a.map(W.data.demande.categories,"name"),", "),InputProps:{readOnly:!0},fullWidth:!0}))),l.a.createElement(m.a,{container:!0,spacing:3},L.data&&L.data.currency===W.data.demande.currency.name?l.a.createElement(m.a,{item:!0,xs:12,sm:12},l.a.createElement(g.F,{className:"mb-24",label:"Budget en "+W.data.demande.currency.name,id:"budget",type:"number",name:"budget",onChange:T,value:P.budget,validations:{isNumeric:!0},validationErrors:{isNumeric:"Numeric value required"},step:"any",InputProps:{min:1},required:!0,fullWidth:!0})):l.a.createElement(l.a.Fragment,null,l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.F,{className:"mb-24",type:"text",name:"description",value:W.data.demande.budget,label:"Budget en "+W.data.demande.currency.name,InputProps:{readOnly:!0},fullWidth:!0})),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.F,{className:"mb-24",label:"Taux de change : "+W.data.demande.currency.name+" => "+L.data.currency,id:"taux",type:"number",name:"taux",value:v.a.toString(_),validations:{isNumeric:!0},validationErrors:{isNumeric:"Numeric value required"},step:"any",InputProps:{min:1,step:"any"},onChange:e=>(function(e){var a=W.data.demande.budget*e.target.value;F(v.a.set({...P},"budget",a)),q(e.target.value)})(e),fullWidth:!0})),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.F,{className:"mb-24",label:"Budget en ("+L.data.currency+")",id:"budget",type:"number",name:"budget",onChange:T,value:v.a.toString(P.budget),validations:{isNumeric:!0},validationErrors:{isNumeric:"Numeric value required"},InputProps:{min:1,step:"any"},required:!0,fullWidth:!0})))),l.a.createElement(g.F,{className:"mb-16  w-full",type:"text",name:"description",value:W.data.demande.description,label:"Description",multiline:!0,rows:"4",InputProps:{readOnly:!0}}),l.a.createElement(m.a,{container:!0,spacing:3},l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.E,{id:"personnel",name:"personnel",value:a,placeholder:"S\xe9lectionner...",textFieldProps:{label:"Affecter \xe0",InputLabelProps:{shrink:!0},variant:"outlined"},className:"mt-20",options:W.personnels,onChange:e=>(function(e,a){F(v.a.set({...P},a,e)),t(e)})(e,"personnel"),required:!0})),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.a,{className:"mt-20",name:"sendEmail",disabled:0!==P.statut||!P.personnel,onChange:e=>(function(e,a){F(v.a.set({...P},a,e.target.checked))})(e,"sendEmail"),label:"Alerter par email"})),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.C,{className:"mt-20 inline",name:"statut",label:"Statut"},l.a.createElement(u.a,{value:"0",disabled:!0,checked:0===P.statut,control:l.a.createElement(p.a,null),label:"En cours"}),l.a.createElement(u.a,{value:"1",disabled:!0,checked:1===P.statut,control:l.a.createElement(p.a,null),label:"Gagn\xe9e"}),l.a.createElement(u.a,{value:"2",disabled:!0,checked:2===P.statut,control:l.a.createElement(p.a,null),label:"Perdue"})))),l.a.createElement(E.a,{type:"submit",variant:"contained",color:"primary",className:"w-200 pr-auto mt-16 normal-case","aria-label":"Suivant",disabled:!b||W.request,value:"legacy"},"Sauvegarder",W.request&&l.a.createElement(f.a,{size:24,className:k.buttonProgress}))),1===Y&&l.a.createElement("div",null,l.a.createElement("div",{className:"flex justify-center sm:justify-start flex-wrap"},W.data.demande.attachements.length>0?W.data.demande.attachements.map(e=>l.a.createElement("div",{className:Object(y.a)(k.consultationImageItem,"flex items-center cursor-pointer justify-center relative w-128 h-128 rounded-4 mr-16 mb-16 overflow-hidden  shadow-1 hover:shadow-5"),key:e.id,onClick:()=>window.open(g.G+e.url,"_blank")},"image"===v.a.split(e.type,"/",1)[0]?l.a.createElement("img",{className:"max-w-none w-auto h-full",src:g.G+e.url,alt:"consultation"}):l.a.createElement(s.a,{color:"secondary",style:{fontSize:80}},"insert_drive_file"))):"Aucune pi\xe8ce jointe attach\xe9e a cette consultation")),2===Y&&(W.data?l.a.createElement(A.a,{className:"flex flex-col"},l.a.createElement(m.a,{container:!0,spacing:3,className:"mb-5"},l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement("div",{className:"flex"},l.a.createElement(g.F,{className:"",type:"text",name:"fullname",value:W.data.demande.acheteur.civilite+" "+W.data.demande.acheteur.firstName+" "+W.data.demande.acheteur.lastName,label:"Nom complet",InputProps:{readOnly:!0},fullWidth:!0}))),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement("div",{className:"flex"},l.a.createElement(g.F,{className:"",name:"email",value:W.data.demande.acheteur.email,label:"Email",fullWidth:!0,InputProps:{readOnly:!0,endAdornment:l.a.createElement(o.a,{position:"end"},l.a.createElement(s.a,{className:"text-20",color:"action"},"email"))}}))),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.F,{className:"",type:"text",name:"phonep",id:"phonep",value:W.data.demande.acheteur.phone,label:"T\xe9l\xe9phone",InputProps:{readOnly:!0,endAdornment:l.a.createElement(o.a,{position:"end"},l.a.createElement(s.a,{className:"text-20",color:"action"},"local_phone"))},fullWidth:!0}))),l.a.createElement(h.a,null),l.a.createElement(m.a,{container:!0,spacing:3,className:"mb-5"},l.a.createElement(m.a,{item:!0,xs:12,sm:8},l.a.createElement("div",{className:"flex"},l.a.createElement(g.F,{className:"mt-20",label:"Raison sociale",id:"societe",name:"societe",value:W.data.demande.acheteur.societe,fullWidth:!0,InputProps:{readOnly:!0}}))),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement("div",{className:"flex"},l.a.createElement(g.F,{className:"mt-20",name:"fix",value:W.data.demande.acheteur.fix,label:"Fixe",InputProps:{readOnly:!0,endAdornment:l.a.createElement(o.a,{position:"end"},l.a.createElement(s.a,{className:"text-20",color:"action"},"local_phone"))},fullWidth:!0}))),l.a.createElement(m.a,{item:!0,xs:12,sm:8},l.a.createElement(g.F,{id:"secteur",className:"",name:"secteur",label:"Secteur",value:W.data.demande.acheteur.secteur?W.data.demande.acheteur.secteur.name:"",fullWidth:!0,InputProps:{readOnly:!0}})),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement("div",{className:"flex"},l.a.createElement(g.F,{id:"website",className:"",type:"text",name:"website",value:W.data.demande.acheteur.website,label:"Site Web",InputProps:{readOnly:!0,endAdornment:l.a.createElement(o.a,{position:"end"},l.a.createElement(s.a,{className:"text-20",color:"action"},"language"))},fullWidth:!0}))),l.a.createElement(m.a,{item:!0,xs:12,sm:8},l.a.createElement("div",{className:"flex"},W.data.demande.acheteur.ice?l.a.createElement(g.F,{className:"",type:"text",name:"ice",id:"ice",value:W.data.demande.acheteur.ice,label:"ICE",fullWidth:!0,InputProps:{readOnly:!0}}):""))),l.a.createElement(h.a,null),l.a.createElement(m.a,{container:!0,spacing:3,className:"mb-5"},l.a.createElement(m.a,{item:!0,xs:12,sm:8},l.a.createElement("div",{className:"flex"},l.a.createElement(g.F,{className:"mt-20",type:"text",name:"adresse1",id:"adresse1",value:W.data.demande.acheteur.adresse1,label:"Adresse 1",InputProps:{readOnly:!0,endAdornment:l.a.createElement(o.a,{position:"end"},l.a.createElement(s.a,{className:"text-20",color:"action"},"location_on"))},fullWidth:!0}))),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.F,{className:"mt-20",type:"text",name:"pays",id:"pays",value:W.data.demande.acheteur.pays?W.data.demande.acheteur.pays.name:"",label:"Pays",InputProps:{readOnly:!0},fullWidth:!0})),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement("div",{className:"flex"},l.a.createElement(g.F,{className:"",type:"text",name:"adresse2",value:W.data.demande.acheteur.adresse2,label:"Adresse 2",InputProps:{readOnly:!0,endAdornment:l.a.createElement(o.a,{position:"end"},l.a.createElement(s.a,{className:"text-20",color:"action"},"location_on"))},fullWidth:!0}))),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement("div",{className:"flex"},l.a.createElement(g.F,{className:"",name:"codepostal",value:String(W.data.demande.acheteur.codepostal),label:"Code Postal",fullWidth:!0,InputProps:{readOnly:!0}}))),l.a.createElement(m.a,{item:!0,xs:12,sm:4},l.a.createElement(g.F,{className:"",type:"text",name:"ville",id:"ville",value:W.data.demande.acheteur.ville?W.data.demande.acheteur.ville.name:"",label:"Ville",InputProps:{readOnly:!0},fullWidth:!0}))),l.a.createElement(h.a,null),l.a.createElement(m.a,{container:!0,spacing:3},l.a.createElement(m.a,{item:!0,xs:12,sm:12},l.a.createElement(g.F,{className:"mb-5 mt-20  w-full",type:"text",name:"description",value:W.data.demande.acheteur.description,label:"Pr\xe9sentation",multiline:!0,rows:"8",InputProps:{readOnly:!0}})))):"")),innerScroll:!0})})}}]);