(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{1260:function(e,t,n){"use strict";var a=n(50),r=n(59),o=n.n(r);const i="[ABONNEMENTS APP] REQUEST ABONNEMENTS",s="[ABONNEMENTS APP] SET PARAMETRES DATA",l="[ABONNEMENTS APP] GET ABONNEMENTS",c="[ABONNEMENTS APP] SET ABONNEMENTS SEARCH TEXT",u="[ABONNEMENTS APP] CLEAN_UP";function d(){return e=>e({type:u})}function f(e){var t="";e.search.length>0&&e.search.map(function(e,n){e.value&&("created"===e.id||"expired"===e.id?t+="&"+e.id+"[after]="+e.value:"statut"===e.id?"0"===e.value?t+="&statut=false&expired[exists]=false":"1"===e.value?t+="&statut=true&expired[strictly_after]=".concat(o()().format("YYYY-MM-DDTHH:mm:ss")):"2"===e.value?t+="&statut=false&expired[strictly_after]=".concat(o()().format("YYYY-MM-DDTHH:mm:ss")):"3"===e.value&&(t+="&expired[strictly_before]=".concat(o()().format("YYYY-MM-DDTHH:mm:ss"))):t+="&"+e.id+"="+e.value)});const n=a.a.get("/api/abonnements?page=".concat(e.page).concat(t,"&order[").concat(e.filter.id,"]=").concat(e.filter.direction));return e=>(e({type:i}),n.then(t=>e({type:l,payload:t.data})))}function m(e){return{type:s,parametres:e}}var p=n(33),E=n(10);const g="[ABONNEMENT APP] REQUEST ABONNEMENT",N="[ABONNEMENT APP] GET ABONNEMENT",h="[ABONNEMENT APP] REQUEST_SOUS_SECTEURS",b="[ABONNEMENT APP] GET SOUS_SECTEURS",y="[ABONNEMENT APP] REQUEST SECTEURS",A="[ABONNEMENT APP] GET SECTEURS",S="[ABONNEMENT APP] REQUEST OFFRES",T="[ABONNEMENT APP] GET OFFRES",O="[ABONNEMENT APP] REQUEST SAVE",v="[ABONNEMENT APP] SAVE ABONNEMENT",P="[ABONNEMENT APP] GET_PAIEMENT",x="[ABONNEMENT APP] CLEAN_UP_FRS",M="[ABONNEMENT APP] GET_DUREE",B="[ABONNEMENT APP] REQUEST_FOURNISSEURS",C="[ABONNEMENT APP] GET_FOURNISSEURS",R="[ABONNEMENT APP] REQUEST_FOURNISSEUR",w="[ABONNEMENT APP] GET_FOURNISSEUR";function j(){return e=>e({type:x})}function U(){const e=a.a.get("/api/durees");return t=>e.then(e=>{t({type:M,payload:e.data["hydra:member"]})})}function F(){const e=a.a.get("/api/fournisseurs?pagination=false&del=false&isactif=true&props[]=id&props[]=societe");return t=>(t({type:B}),e.then(e=>{t({type:C,payload:e.data["hydra:member"]})}))}function H(e){const t=a.a.get(e);return e=>(e({type:R}),t.then(t=>{e({type:w,payload:t.data})}))}function Y(e,t,n,r,o,i,s){var l={offre:n["@id"],sousSecteurs:E.a.map(t,function(e,t){return e.value}),mode:r,duree:o["@id"],fournisseur:e.fournisseur.value,commentaire:e.commentaire,statut:s,remise:i?parseFloat(i):0};const c=a.a.post("/api/abonnements",l);return e=>(e({type:O}),c.then(t=>(e(Object(p.B)({message:"Abonnement sauvegarder"})),e({type:v,payload:t.data}))))}function D(e,t,n,r,o,i,s){var l={...e,offre:n["@id"],sousSecteurs:E.a.map(t,function(e,t){return e.value}),mode:r,duree:o["@id"],commentaire:e.commentaire,statut:s,remise:i?parseFloat(i):0};const c=a.a.put(e["@id"],l);return e=>(e({type:O}),c.then(t=>(e(Object(p.B)({message:"Abonnement modifi\xe9e avec succ\xe8s"})),e({type:v,payload:t.data}))))}function _(e,t,n,r,o,i,s,l){var c={offre:n["@id"],sousSecteurs:E.a.map(t,function(e,t){return e.value}),mode:r,duree:o["@id"],fournisseur:e.fournisseur.value,statut:s,commentaire:e.commentaire,remise:i?parseFloat(i):0,type:"1"==l};const u=a.a.post("/api/abonnements",c);return e=>(e({type:O}),u.then(t=>(e(Object(p.B)({message:"Abonnement sauvegarder"})),e({type:v,payload:t.data}))))}function k(e){const t=a.a.get("".concat(e,"/sous_secteurs?pagination=false&props[]=id&props[]=name"));return e=>(e({type:h}),t.then(t=>{e({type:b,payload:t.data["hydra:member"]})}))}function I(){const e=a.a.get("/api/secteurs?pagination=false&props[]=id&props[]=name&order[name]=asc");return t=>(t({type:y}),e.then(e=>{t({type:A,payload:e.data["hydra:member"]})}))}function L(){const e=a.a.get("/api/paiements");return t=>e.then(e=>{t({type:P,payload:e.data["hydra:member"]})})}function G(){const e=a.a.get("/api/offres");return t=>(t({type:S}),e.then(e=>t({type:T,payload:e.data["hydra:member"]})))}function Q(e){const t=a.a.get("/api/abonnements/".concat(e));return e=>(e({type:g}),t.then(t=>e({type:N,payload:t.data})))}function z(){return{type:N,payload:{offre:null,commentaire:"",sousSecteurs:[]}}}n.d(t,"m",function(){return i}),n.d(t,"w",function(){return s}),n.d(t,"d",function(){return l}),n.d(t,"v",function(){return c}),n.d(t,"a",function(){return u}),n.d(t,"x",function(){return d}),n.d(t,"A",function(){return f}),n.d(t,"L",function(){return m}),n.d(t,"l",function(){return g}),n.d(t,"c",function(){return N}),n.d(t,"s",function(){return h}),n.d(t,"k",function(){return b}),n.d(t,"r",function(){return y}),n.d(t,"j",function(){return A}),n.d(t,"p",function(){return S}),n.d(t,"h",function(){return T}),n.d(t,"q",function(){return O}),n.d(t,"t",function(){return v}),n.d(t,"u",function(){return"[ABONNEMENT APP] SAVE ERROR"}),n.d(t,"i",function(){return P}),n.d(t,"a",function(){}),n.d(t,"b",function(){return x}),n.d(t,"e",function(){return M}),n.d(t,"o",function(){return B}),n.d(t,"g",function(){return C}),n.d(t,"n",function(){return R}),n.d(t,"f",function(){return w}),n.d(t,"y",function(){return j}),n.d(t,"B",function(){return U}),n.d(t,"D",function(){return F}),n.d(t,"C",function(){return H}),n.d(t,"J",function(){return Y}),n.d(t,"M",function(){return D}),n.d(t,"K",function(){return _}),n.d(t,"H",function(){return k}),n.d(t,"G",function(){return I}),n.d(t,"F",function(){return L}),n.d(t,"E",function(){return G}),n.d(t,"z",function(){return Q}),n.d(t,"I",function(){return z})},1303:function(e,t,n){"use strict";var a=n(43),r=n(1260),o=n(102);const i={data:[],pageCount:null,loading:!1,searchText:"",parametres:{page:1,search:[],filter:{id:"created",direction:"desc"}}};var s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case r.a:return{...i};case r.m:return{...e,loading:!0};case r.d:return{...e,data:t.payload["hydra:member"],pageCount:o.a.hydraPageCount(t.payload),loading:!1};case r.v:return{...e,searchText:t.searchText};case r.w:return{...e,parametres:{page:t.parametres.page,search:t.parametres.search,filter:{id:t.parametres.filter.id,direction:t.parametres.filter.direction}}};default:return e}};const l={data:null,offres:null,sousSecteurs:null,loadingSecteurs:!1,secteurs:null,error:null,loading:!1,loadingSS:!1,success:!1,paiements:null,durees:null,loadingFournisseurs:!1,fournisseurs:null,fournisseur:null};var c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case r.l:case r.p:case r.q:return{...e,loading:!0};case r.o:case r.n:return{...e,loadingFournisseurs:!0};case r.g:return{...e,fournisseurs:t.payload,loadingFournisseurs:!1};case r.f:return{...e,fournisseur:t.payload,loadingFournisseurs:!1};case r.i:return{...e,paiements:t.payload};case r.e:return{...e,durees:t.payload};case r.t:return{...e,loading:!1,success:!0};case r.a:return{...l};case r.b:return{...e,fournisseur:null};case r.c:return{...e,data:t.payload,loading:!1};case r.r:return{...e,loadingSecteurs:!0};case r.j:return{...e,secteurs:t.payload,loadingSecteurs:!1};case r.s:return{...e,loadingSS:!0};case r.k:return{...e,sousSecteurs:t.payload,loadingSS:!1};case r.h:return{...e,offres:t.payload,loading:!1};case r.u:return{...e,error:t.payload,loading:!1};default:return e}},u=n(33);const d={state:!1,options:{children:"Hi"}};var f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u.f:return{...e,state:!0,options:{...e.options,...t.options}};case u.a:return{...e,state:!1};default:return e}};const m=Object(a.d)({abonnements:s,abonnement:c,dialog:f});t.a=m},1590:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(39),i=n(136),s=n(1151),l=n(1160),c=n(1221),u=n(1140),d=n(1204),f=n(71),m=n(1260),p=n(7),E=n(59),g=n.n(E),N=n(102),h=n(365),b=n(1226),y=n(10);const A=Object(b.a)(e=>({root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}},chip:{marginLeft:e.spacing(1),padding:2,background:"#ef5350",color:"white",fontWeight:"bold",fontSize:"11px",height:20},chip2:{marginLeft:e.spacing(1),padding:2,background:"#4caf50",color:"white",fontWeight:"bold",fontSize:"11px",height:20},chipOrange:{marginLeft:e.spacing(1),padding:2,background:"#ff9800",color:"white",fontWeight:"bold",fontSize:"11px",height:20}}));var S=Object(f.g)(function(e){const t=A(),n=Object(p.b)(),i=Object(p.c)(e=>{let{abonnementOffreApp:t}=e;return t.abonnements.data}),f=Object(p.c)(e=>{let{abonnementOffreApp:t}=e;return t.abonnements.loading}),E=Object(p.c)(e=>{let{abonnementOffreApp:t}=e;return t.abonnements.pageCount}),b=Object(p.c)(e=>{let{abonnementOffreApp:t}=e;return t.abonnements.parametres}),S=Object(p.c)(e=>{let{abonnementOffreApp:t}=e;return t.abonnements.searchText}),[T,O]=Object(a.useState)(null);if(Object(a.useEffect)(()=>{i&&O(function(e,t){const n=Object.keys(e).map(t=>e[t]);return 0===t.length?n:N.a.filterArrayByString(n,t)}(i,S))},[i,S]),!T)return null;const v=y.a.debounce(e=>n(m.L(e)),1e3);return r.a.createElement(o.d,{animation:"transition.slideUpIn",delay:300},r.a.createElement(h.b,{className:"-striped -highlight h-full sm:rounded-16 overflow-hidden",getTrProps:(e,t,n)=>({className:"h-64"}),getTheadProps:(e,t,n)=>({className:"h-64 font-bold"}),data:T,columns:[{Header:"R\xe9f\xe9rence",className:"font-bold",accessor:"reference",filterable:!0,Cell:e=>e.original.reference},{Header:"Offre",className:"font-bold",accessor:"offre.name",filterable:!0,Cell:e=>e.original.offre?e.original.offre.name:""},{Header:"Fournisseur",className:"font-bold",accessor:"fournisseur.societe",filterable:!0,Cell:e=>e.original.fournisseur?e.original.fournisseur.societe:""},{Header:"Mode de paiement",accessor:"mode.name",filterable:!0,Cell:e=>e.original.mode?e.original.mode.name:""},{Header:"Activit\xe9s",accessor:"sousSecteurs.name",filterable:!0,Cell:e=>y.a.truncate(y.a.join(y.a.map(e.original.sousSecteurs,"name"),", "),{length:25,separator:" "})},{Header:"Date de cr\xe9ation",accessor:"created",filterable:!0,Cell:e=>g()(e.original.created).format("DD/MM/YYYY HH:mm"),Filter:e=>{let{filter:t,onChange:n}=e;return r.a.createElement(s.a,{onChange:e=>n(e.target.value),style:{width:"100%"},value:t?t.value:"",type:"date",InputLabelProps:{shrink:!0}})}},{Header:"Date d'expiration",accessor:"expired",filterable:!0,Cell:e=>e.original.expired&&g()(e.original.expired).format("DD/MM/YYYY HH:mm")+" ( "+g()(e.original.expired).diff(g()(),"days")+" j )",Filter:e=>{let{filter:t,onChange:n}=e;return r.a.createElement(s.a,{onChange:e=>n(e.target.value),style:{width:"100%"},value:t?t.value:"",type:"date",InputLabelProps:{shrink:!0}})}},{Header:"Statut",accessor:"statut",sortable:!1,filterable:!0,Cell:e=>r.a.createElement("div",{className:"flex items-center"},!1===e.original.statut?e.original.expired&&void 0!==e.original.expired?g()(e.original.expired)>=g()()?r.a.createElement(l.a,{className:t.chip,label:"Annul\xe9"}):r.a.createElement(l.a,{className:t.chip,label:"Expir\xe9"}):r.a.createElement(l.a,{className:t.chipOrange,label:"En attente"}):g()(e.original.expired)>=g()()?r.a.createElement(l.a,{className:t.chip2,label:"En cours"}):r.a.createElement(l.a,{className:t.chip,label:"Expir\xe9"})),Filter:e=>{let{filter:t,onChange:n}=e;return r.a.createElement("select",{onChange:e=>n(e.target.value),style:{width:"100%"},value:t?t.value:""},r.a.createElement("option",{value:""},"Tous"),r.a.createElement("option",{value:"0"},"En attente"),r.a.createElement("option",{value:"1"},"En cours"),r.a.createElement("option",{value:"2"},"Annul\xe9"),r.a.createElement("option",{value:"3"},"Expir\xe9"))}},{Header:"",Cell:t=>r.a.createElement("div",{className:"flex items-center"},(g()(t.original.expired)>=g()()||!t.original.expired)&&r.a.createElement(c.a,{title:"Editer"},r.a.createElement(u.a,{className:"text-orange text-20",onClick:()=>e.history.push("/admin/offres/abonnement/"+t.original.id)},r.a.createElement(d.a,null,"edit"))),!0===t.original.statut&&g()(t.original.expired).diff(g()(),"month",!0)<=1&&g()(t.original.expired).diff(g()(),"month",!0)>0&&r.a.createElement(c.a,{title:"Renouveler"},r.a.createElement(u.a,{onClick:()=>{e.history.push("/admin/offres/renouvellement/"+t.original.id+"/1")},className:"text-teal text-20"},r.a.createElement(d.a,null,"autorenew"))),!0===t.original.statut&&g()(t.original.expired)<g()()&&r.a.createElement(c.a,{title:"Dupliquer"},r.a.createElement(u.a,{onClick:()=>{e.history.push("/admin/offres/renouvellement/"+t.original.id+"/2")},className:"text-green-700 text-20"},r.a.createElement(d.a,null,"file_copy"))))}],manual:!0,pages:E,page:b.page-1,defaultPageSize:10,loading:f,showPageSizeOptions:!1,onPageChange:e=>{b.page=e+1,n(m.L(b))},onSortedChange:(e,t,a)=>{b.page=1,b.filter.id=e[0].id,b.filter.direction=e[0].desc?"desc":"asc",n(m.L(b))},onFilteredChange:e=>{b.page=1,b.search=e,v(b)},noDataText:"Aucune abonnement trouv\xe9e",loadingText:"Chargement...",ofText:"sur"}))}),T=n(89),O=n(1227),v=n(16);var P=function(e){return r.a.createElement("div",{className:"flex flex-1 w-full items-center justify-between"},r.a.createElement("div",{className:"flex items-center"},r.a.createElement(o.d,{animation:"transition.expandIn",delay:300},r.a.createElement(d.a,{className:"text-32 mr-0 sm:mr-12"},"cloud")),r.a.createElement(o.d,{animation:"transition.slideLeftIn",delay:300},r.a.createElement(T.a,{className:"hidden sm:flex",variant:"h6"},"Abonnements"))),r.a.createElement("div",{className:"flex flex-1 items-center justify-center px-12"}),r.a.createElement(o.d,{animation:"transition.slideRightIn",delay:300},r.a.createElement(O.a,{component:v.a,to:"/admin/offres/abonnement/new",className:"whitespace-no-wrap",variant:"contained"},r.a.createElement("span",{className:"hidden sm:flex"},"Ajouter nouveau abonnement"),r.a.createElement("span",{className:"flex sm:hidden"},"New"))))},x=n(1303),M=n(364);t.default=Object(i.a)("abonnementOffreApp",x.a)(function(){const e=Object(p.b)(),t=Object(p.c)(e=>{let{abonnementOffreApp:t}=e;return t.abonnements.parametres});return Object(a.useEffect)(()=>{e(m.A(t))},[e,t]),r.a.createElement(r.a.Fragment,null,r.a.createElement(M.Helmet,null,r.a.createElement("title",null,"Abonnements | Les Achats Industriels"),r.a.createElement("meta",{name:"robots",content:"noindex, nofollow"}),r.a.createElement("meta",{name:"googlebot",content:"noindex"})),r.a.createElement(o.o,{classes:{content:"flex flex-col h-full",header:"min-h-72 h-72 sm:h-136 sm:min-h-136"},header:r.a.createElement(P,null),content:r.a.createElement(S,null),innerScroll:!0}))})}}]);